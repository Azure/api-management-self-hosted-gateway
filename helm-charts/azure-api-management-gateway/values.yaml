# Default values for azure-api-management-gateway.
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

# -- Number of gateway replicas to deploy. Set to 'null' to remove `replicaCount` property from the deployment.
replicaCount: 3

image:
  # -- Repository which provides the image.
  repository: mcr.microsoft.com/azure-api-management/gateway
  # -- Policy to pull image.
  pullPolicy: IfNotPresent
  # -- Tag of image to use. Defaults to app version of Helm chart.
  tag: 

# -- Image pull secrets for private registries.
imagePullSecrets: []
# -- Override the name of the chart.
nameOverride: ""
# -- Override the full name of the release.
fullnameOverride: ""

gateway:
  # -- Name of the gateway resource in Azure API Management. This is required when using Azure AD authentication (WorkloadIdentity or AzureAdApp). Find this in the Azure Portal under your API Management instance.
  name: 
  deployment:
    # -- Maximum time in seconds the Pod may spend in the Terminating phase during shutdown. The gateway uses this time to gracefully complete ongoing requests. Learn more [about the termination of Pods](https://kubernetes.io/docs/concepts/containers/container-lifecycle-hooks/#hook-handler-execution).
    terminationGracePeriodSeconds: 60
    # -- Deployment [strategy](https://kubernetes.io/docs/concepts/workloads/controllers/deployment/#strategy) to use for replacing old pods. May be `Recreate` (stop all old pods before creating new ones) or `RollingUpdate` (default, gradually replace pods).
    strategy: {}
      # https://kubernetes.io/docs/concepts/workloads/controllers/deployment/#strategy
      # type: RollingUpdate
      # rollingUpdate:
      #   maxUnavailable: 0
      #   maxSurge: 25%
    network:
      proxy:
        # -- HTTP network proxy address for outbound HTTP requests to backend services (egress). Format: `http://proxy.example.com:8080`.
        http: 
        # -- HTTPS network proxy address for outbound HTTPS requests to backend services (egress). Format: `http://proxy.example.com:8080`.
        https: 
        # -- Comma-separated list of addresses/domains to bypass when using an HTTP(S) network proxy. Example: `localhost,127.0.0.1,.svc.cluster.local`.
        bypass: 
    dns:
      # -- Add custom host aliases to /etc/hosts in the gateway pod (useful for custom configuration endpoints). Check the [values.yaml](./values.yaml) for format details.
      hostAliases: {}
        # - ip: "<ip address>"
        #   hostnames:
        #   - "<instanceName>.configuration.azure-api.net"      
    # -- Specify additional custom annotations to be set for the deployment manifest.
    #annotations:
    #  com.example/local: "test"
  configuration:
    # -- **Required.** Configuration endpoint URL from your Azure API Management gateway resource. Find this in the Azure Portal under the gateway's Deployment section. Format: `https://<gateway-name>.configuration.azure-api.net`.
    uri: 
    backup:
      # -- Enable storing a backup copy of the latest downloaded gateway configuration on a persistent volume. This allows the gateway to start with last-known configuration if it cannot reach Azure API Management.
      enabled: false
      persistentVolumeClaim:
        # -- Use an existing Persistent Volume Claim (PVC) for configuration backup instead of creating one. Requires `*.persistentVolumeClaim.create` to be false.
        existingName: ""
        # -- Create a new Persistent Volume Claim (PVC) for configuration backup with the settings specified below.
        create: true
        # -- Storage class name for the Persistent Volume Claim (PVC). `null` uses the cluster default storage class, `""` means no storage class will be set.
        storageClassName: null
        # -- Access mode for the Persistent Volume Claim (PVC). Use `ReadWriteMany` for multi-replica deployments, `ReadWriteOnce` for single replica.
        accessMode: ReadWriteMany
        # -- Size of the Persistent Volume Claim (PVC) for configuration backup.
        size: 50Mi
    # -- Advanced: Specify additional gateway configuration settings not yet supported by the Helm chart. See [Azure API Management self-hosted gateway configuration](https://docs.microsoft.com/azure/api-management/self-hosted-gateway-settings-reference).
    additional: {}
  auth:
    # -- Type of authentication to use for Azure API Management's Configuration API. Options: `GatewayToken` (use gateway.auth.key), `AzureAdApp` (use client secret/certificate), or `WorkloadIdentity` (use managed identity).
    type: GatewayToken
    # -- **Required for GatewayToken auth.** Authentication token from Azure API Management gateway resource. Starts with `GatewayKey`. Find this in the Azure Portal under the gateway's Deployment section. Not used when an existing secret is configured.
    key: 
    azureAd:
      tenant: 
        # -- **Required for AzureAdApp auth.** Azure AD tenant ID (GUID). Find this in Azure Portal under Azure Active Directory â†’ Properties.
        id:
      # -- Azure AD authority URL. Defaults to public Azure AD if not specified. Example: `https://login.microsoftonline.com/<tenant-id>`.
      authority: 
      app:
        # -- **Required for AzureAdApp and WorkloadIdentity auth.** Client ID (application ID) of the Azure AD app registered for gateway authentication. Find this in Azure Portal under App registrations.
        id: 
        # -- **Required for AzureAdApp auth (client secret).** Client secret of the Azure AD app. Not used with WorkloadIdentity. Not used when an existing secret is configured.
        secret: 

secret:
  # -- Indication whether or not a Kubernetes secret should be created to store the authentication token.
  createSecret: true
  # -- Name of the existing secret to be used by the gateway. Requires `secret.createSecret` to be false.
  existingSecretName: ""

observability:
  logs:
    std:
      # -- Format of standard output logs also referred to as container logs. Allowed values are `none`, `text` or `json`. Learn more in [our documentation](https://docs.microsoft.com/azure/api-management/how-to-configure-local-metrics-logs#logs).
      format: text
      # -- Level of logs outputted to standard output. Allowed values are `all`, `debug`, `info`, `warn`, `error` or `fatal`. Learn more in [our documentation](https://docs.microsoft.com/azure/api-management/how-to-configure-local-metrics-logs#logs).
      level: info
      # -- Indication whether or not output messages should use color. Allowed values are `true` or `false`.
      useColor: true
    local:
      # -- Type of local logs to use. Allowed values are `none`, `auto`, `localsyslog`, `rfc5424`, `journal`, `json` or `forward`. Learn more in [our documentation](https://docs.microsoft.com/azure/api-management/how-to-configure-local-metrics-logs#logs).
      type: auto
      localsyslog:
        # -- Endpoint to send logs to with localsyslog protocol. Learn more in [our documentation](https://docs.microsoft.com/azure/api-management/how-to-configure-local-metrics-logs#logs).
        endpoint:
        # -- Facility code as per [localsyslog](https://en.wikipedia.org/wiki/Syslog#Facility), for example `7`. Learn more in [our documentation](https://docs.microsoft.com/azure/api-management/how-to-configure-local-metrics-logs#logs).
        facility:
      rfc5424:
        # -- Endpoint to send logs to with rfc5424 protocol. Learn more in [our documentation](https://docs.microsoft.com/azure/api-management/how-to-configure-local-metrics-logs#logs).
        endpoint:
        # -- Facility code as per [rfc5424](https://tools.ietf.org/html/rfc5424), for example `7`. Learn more in [our documentation](https://docs.microsoft.com/azure/api-management/how-to-configure-local-metrics-logs#logs).
        facility:
      journal:
        # -- Endpoint to send logs to with journal protocol. Learn more in [our documentation](https://docs.microsoft.com/azure/api-management/how-to-configure-local-metrics-logs#logs).
        endpoint:
      json:
        # -- UDP endpoint that accepts JSON data. This can be a file path, `IP:port`, or `hostname:port` convention. Learn more in [our documentation](https://docs.microsoft.com/azure/api-management/how-to-configure-local-metrics-logs#logs).
        endpoint: 127.0.0.1:8888

  azureMonitor:
    metrics:
      # -- Enable sending metrics to Azure Monitor. This allows you to monitor gateway performance in Azure Portal. Learn more in [our documentation](https://docs.microsoft.com/en-us/azure/api-management/how-to-configure-cloud-metrics-logs#metrics).
      enabled: true
  opentelemetry:
    # -- Enable OpenTelemetry observability for the gateway. This provides distributed tracing and enhanced metrics. Learn more in [our documentation](https://docs.microsoft.com/azure/api-management/how-to-deploy-self-hosted-gateway-kubernetes-opentelemetry).
    enabled: false
    collector:
      # -- OpenTelemetry Collector endpoint URI to push metrics and traces to. Format: `http://otel-collector:4317` (gRPC) or `http://otel-collector:4318` (HTTP). Learn more in [our documentation](https://docs.microsoft.com/azure/api-management/how-to-deploy-self-hosted-gateway-kubernetes-opentelemetry).
      uri: 
    histogram:
      # -- Define custom bucket sizes for all histograms in OpenTelemetry metrics. Comma-separated values in milliseconds. Example: `10,20,50,100,200,500,1000`. Learn more in [our documentation](https://docs.microsoft.com/azure/api-management/how-to-deploy-self-hosted-gateway-kubernetes-opentelemetry).
      buckets:
    systemMetrics:
      # -- Enable collecting system metrics (CPU, memory) via OpenTelemetry in addition to API metrics.
      enabled: false
  statsD:
    # -- Enable pushing StatsD metrics from the gateway. Useful for integration with Prometheus, Datadog, or other StatsD-compatible systems. Learn more in [our documentation](https://docs.microsoft.com/azure/api-management/how-to-configure-local-metrics-logs#configure-the-self-hosted-gateway-to-emit-metrics).
    enabled: false
    # -- StatsD endpoint to push metrics to. Format: `udp://statsd-server:8125`. Learn more in [our documentation](https://docs.microsoft.com/azure/api-management/how-to-configure-local-metrics-logs#configure-the-self-hosted-gateway-to-emit-metrics).
    endpoint: 
    # -- Metrics sampling rate. Value between `0` (no metrics) and `1` (all metrics). Example: `0.5` samples 50% of requests. Learn more in [our documentation](https://docs.microsoft.com/azure/api-management/how-to-configure-local-metrics-logs#configure-the-self-hosted-gateway-to-emit-metrics).
    sampling: 1
    # -- StatsD [tagging format](https://github.com/prometheus/statsd_exporter#tagging-extensions) for metric tags. Options: `none`, `librato`, `dogStatsD`, `influxDB`. Use `dogStatsD` for Datadog compatibility. Learn more in [our documentation](https://docs.microsoft.com/azure/api-management/how-to-configure-local-metrics-logs#configure-the-self-hosted-gateway-to-emit-metrics).
    tagFormat: dogStatsD

security:
  tls:
    server:
      ciphers:
        # -- Comma-separated list of TLS cipher suites for client-to-gateway connections. Use this to enforce strong encryption or comply with security policies. Example: `TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256`. Learn more in our [security / TLS documentation](https://aka.ms/apim/sputnik/security/tls). Default cipher suites are used as per [our documentation](https://docs.microsoft.com/azure/api-management/self-hosted-gateway-overview#available-cipher-suites).
        allowedSuites: 
    client:
      ciphers:
        # -- Comma-separated list of TLS cipher suites for gateway-to-backend connections. Use this to ensure compatibility with backend systems or enforce strong encryption. Example: `TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256`. Learn more in our [security / TLS documentation](https://aka.ms/apim/sputnik/security/tls). Default cipher suites are used as per [our documentation](https://docs.microsoft.com/azure/api-management/self-hosted-gateway-overview#available-cipher-suites).
        allowedSuites: 

dapr:
  # -- Indication whether or not Dapr integration should be used.
  enabled: false
  app:
    # -- Application ID to use for Dapr integration.
    id:
  # -- Defines which Configuration CRD Dapr should use.
  config: tracing
  logging:
    # -- Indication whether or not logging should be in JSON format.
    useJsonOutput: true
    # -- Level of log verbosity of Dapr sidecar.
    level: info

service:
  # -- Type of Kubernetes service to use to expose to serve traffic.
  type: ClusterIP
  loadBalancer:
    # -- Defines if node ports will be automatically allocated for services with type `LoadBalancer`.
    allocateNodePorts: true
  ports:
    # -- Port for HTTP traffic on service for other pods to talk to.
    http: 8080
    # -- Port for HTTPS traffic on service for other pods to talk to.
    https: 8081
    instance:
      # -- Port used for internal discovery of gateway instances to synchronize across all of them, ie for rate limiting.
      synchronization: 4290
      # -- Port used for sending heartbeats to all instances for synchronization purposes.
      heartbeat: 4291
  # -- Annotations to add to the Kubernetes service.
  annotations: {}

ingress:
  # Experimental feature: See https://github.com/Azure/api-management-self-hosted-gateway-ingress
  controller:
    # -- **Experimental.** Enable Self-Hosted gateway to act as a Kubernetes Ingress controller. This feature is experimental and under active development. See the [ingress controller repository](https://github.com/Azure/api-management-self-hosted-gateway-ingress) for details and limitations.
    enabled: false
    # -- **Experimental.** Kubernetes namespace to watch for Ingress resources. Empty string watches all namespaces. See the [ingress controller repository](https://github.com/Azure/api-management-self-hosted-gateway-ingress).
    namespace: ""
    # -- **Experimental.** Annotations to add to managed Ingress resources. See the [ingress controller repository](https://github.com/Azure/api-management-self-hosted-gateway-ingress).
    annotations: []
    dns:
      # -- **Experimental.** DNS suffix for building Kubernetes service hostnames inside the cluster. Example: `svc.cluster.local`. See the [ingress controller repository](https://github.com/Azure/api-management-self-hosted-gateway-ingress).
      suffix: "svc.cluster.local"
    ingressClass:
      # -- **Experimental.** Controller name for the IngressClass resource. See the [ingress controller repository](https://github.com/Azure/api-management-self-hosted-gateway-ingress).
      controller: "azure-api-management/gateway"
      # -- **Experimental.** Annotations to apply to the IngressClass resource. See the [ingress controller repository](https://github.com/Azure/api-management-self-hosted-gateway-ingress).
      annotations: []

# -- **Deprecated - Use `serviceAccount.name` instead.** Legacy field for specifying an existing service account. By default, a service account is now auto-generated with release name (see `serviceAccount.create`).
serviceAccountName: ""

serviceAccount:
  # -- The name of the service account to use. If not set and `create` is true, a name is generated using the fullname template. If not set and `create` is false, falls back to `serviceAccountName` value.
  name: ""
  # -- Specifies whether a service account should be created. When true, a service account is automatically generated with the deployment name.
  create: true
  # -- Annotations to add to the service account.
  annotations: {}
  # -- Labels to add to the service account.
  labels: {}

probes:
  # -- Configuration for readiness probes of the container. Uses `/status-0123456789abcdef` as endpoint for HTTP probes.
  readiness:
    httpGet:
      path: /status-0123456789abcdef
      port: http
  # -- Configuration for liveness probes of the container. Uses `/status-0123456789abcdef` as endpoint for HTTP probes.
  liveness:
    httpGet:
      path: /status-0123456789abcdef
      port: http
  # -- Configuration for startup probes of the container. Uses `/status-0123456789abcdef` as endpoint for HTTP probes.
  startup:
    httpGet:
      path: /status-0123456789abcdef
      port: http

# -- Pod resource requests & limits. We usually recommend not to specify default resources and to leave this as a conscious choice for the user. This also increases chances charts run on environments with little resources, such as Minikube. If you do want to specify resources, uncomment the following lines, adjust them as necessary, and remove the curly braces after 'resources:'.
resources: {}
  # limits:
  #   cpu: 100m
  #   memory: 128Mi
  # requests:
  #   cpu: 100m
  #   memory: 128Mi

highAvailability:
  # -- Deploy the gateway with high availability features enabled. When true, distributes pods across availability zones and prevents voluntary disruptions. Recommended for production deployments.
  enabled: true
  disruption:
    # -- Maximum percentage or number of pods that can be unavailable during [voluntary disruptions](https://kubernetes.io/docs/concepts/workloads/pods/disruptions/#voluntary-and-involuntary-disruptions) like node drains or deployments. Example: `25%` or `1`.
    maximumUnavailable: 25%
  podTopologySpread:
    # -- How to handle pod scheduling when topology spread constraints cannot be met. `ScheduleAnyway` allows scheduling even if constraints are not met (preferred), `DoNotSchedule` prevents scheduling. Learn more in the [Kubernetes docs](https://kubernetes.io/docs/concepts/workloads/pods/pod-topology-spread-constraints/).
    whenUnsatisfiable: ScheduleAnyway

# -- Node selector for pod assignment.
nodeSelector: {}

# -- Tolerations for pod assignment.
tolerations: []

# -- Affinity for pod assignment.
affinity: {}

# -- Privilege and access control settings for the container.
securityContext: {}
  # allowPrivilegeEscalation: false
  # runAsNonRoot: true
  # runAsUser: 1001       # This is a built-in user, but you can use any user ie 1000 as well
  # runAsGroup: 2000      # This is just an example
  # privileged: false
  # capabilities:
  #   drop:
  #   - all

# -- Privilege and access control settings for the pod.
podSecurityContext: {}
  # fsGroup: 2000
  # fsGroupChangePolicy: OnRootMismatch # "OnRootMismatch" or "Always"
  # runAsNonRoot: true
  # runAsUser: 1001       # This is a built-in user, but you can use any user ie 1000 as well
  # runAsGroup: 2000      # This is just an example

# -- Custom labels to add to all deployed objects.
commonLabels: {}
  # Labels to add to all deployed objects